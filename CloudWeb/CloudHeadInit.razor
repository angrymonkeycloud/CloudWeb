@namespace AngryMonkey.CloudWeb
@using Microsoft.AspNetCore.Http

@inject CloudWebConfig cloudWeb
@inject CloudPage _page
@inject IHttpContextAccessor _accessor

<CloudHead CloudPage="PageConfig" />
<CloudBundles CloudPage="PageConfig" />

@code {
    // [Parameter] public required CloudPage CloudPage { get; set; }

    protected CloudPage PageConfig
    {
        get
        {
            _page ??= new();

            CloudPage config = new()
                {
                    // Nullable

                    Title = _page.Title,
                    Keywords = _page.Keywords ?? cloudWeb.PageDefaults.Keywords,
                    Description = _page.Description ?? cloudWeb.PageDefaults.Description,
                    TitleAddOns = _page.TitleAddOns ?? cloudWeb.PageDefaults.TitleAddOns,
                    CallingAssemblyName = _page.CallingAssemblyName ?? cloudWeb.PageDefaults.CallingAssemblyName,

                    // Not Nullable

                    Favicon = _page.Favicon ?? cloudWeb.PageDefaults.Favicon ?? "/favicon.ico",
                    BaseUrl = _page.BaseUrl ?? cloudWeb.PageDefaults.BaseUrl ?? "/",
                    IndexPage = _page.IndexPage ?? cloudWeb.PageDefaults.IndexPage ?? true,
                    FollowPage = _page.FollowPage ?? cloudWeb.PageDefaults.FollowPage ?? true,
                    AutoAppendBlazorStyles = _page.AutoAppendBlazorStyles ?? cloudWeb.PageDefaults.AutoAppendBlazorStyles ?? false
                };

            config.Bundles = new(cloudWeb.PageDefaults.Bundles);
            config.Bundles.AddRange(_page.Bundles);

            config.Features = new(cloudWeb.PageDefaults.Features);
            config.Features.AddRange(_page.Features);

            return config;
        }
    }
}